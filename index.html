<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcana Flow - Mystical Productivity</title>
    <link rel="stylesheet" href="styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Raleway:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="config.js"></script>
</head>

<body>
    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="logo">
            <span class="logo-icon"><i data-lucide="moon" class="lucide-icon"></i></span>
            <span class="logo-text">Arcana Flow</span>
        </div>
        <button class="sidebar-toggle" id="sidebarToggle">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Particle Background -->
    <div class="particles" id="particles"></div>

    <!-- Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <button class="sidebar-close-btn"><i data-lucide="x" class="lucide-icon"></i></button>
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon"><i data-lucide="moon" class="lucide-icon"></i></span>
                <span class="logo-text">Arcana Flow</span>
            </div>

            <!-- XP & Level System -->
            <div class="user-level-container">
                <div class="level-info">
                    <span class="level-text">Neophyte</span>
                    <span class="level-number">Lvl <span id="userLevel">1</span></span>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar" id="userXPBar" style="width: 0%"></div>
                </div>
                <span class="xp-text"><span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP</span>
            </div>

            <button class="sidebar-toggle" id="sidebarToggleInternal">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <div class="nav-scroll">
            <div class="nav-section">
                <span class="nav-label">Main</span>
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="nav-icon"><i data-lucide="layout-dashboard"></i></span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="flows">
                    <span class="nav-icon"><i data-lucide="workflow"></i></span>
                    <span class="nav-text">Flows</span>
                </a>
                <a href="#" class="nav-item" data-page="magick">
                    <span class="nav-icon"><i data-lucide="sparkles"></i></span>
                    <span class="nav-text">Magick Workings</span>
                </a>
            </div>

            <div class="nav-section">
                <span class="nav-label">Productivity</span>
                <a href="#" class="nav-item" data-page="todos">
                    <span class="nav-icon"><i data-lucide="check-square"></i></span>
                    <span class="nav-text">Tasks</span>
                </a>
                <a href="#" class="nav-item" data-page="weekly-schedule">
                    <span class="nav-icon"><i data-lucide="calendar-days"></i></span>
                    <span class="nav-text">Weekly Schedule</span>
                </a>
                <a href="#" class="nav-item" data-page="pomodoro">
                    <span class="nav-icon"><i data-lucide="timer"></i></span>
                    <span class="nav-text">Pomodoro</span>
                </a>
                <a href="#" class="nav-item" data-page="mastery">
                    <span class="nav-icon"><i data-lucide="trophy"></i></span>
                    <span class="nav-text">Mastery</span>
                </a>
            </div>

            <div class="nav-section">
                <span class="nav-label">Records</span>
                <a href="#" class="nav-item" data-page="calendar">
                    <span class="nav-icon"><i data-lucide="calendar"></i></span>
                    <span class="nav-text">Calendar</span>
                </a>
                <a href="#" class="nav-item" data-page="journal">
                    <span class="nav-icon"><i data-lucide="book-open"></i></span>
                    <span class="nav-text">Journal</span>
                </a>
                <a href="#" class="nav-item" data-page="stats">
                    <span class="nav-icon"><i data-lucide="bar-chart-3"></i></span>
                    <span class="nav-text">Statistics</span>
                </a>
            </div>

            <div class="nav-section nav-bottom">
                <a href="#" class="nav-item" data-page="settings">
                    <span class="nav-icon">âš™</span>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
        </div>

        <!-- Astro Widgets -->
        <div class="astro-widgets">
            <div class="moon-phase-widget">
                <div class="moon-icon" id="moonIcon">ðŸŒ™</div>
                <div class="moon-details">
                    <span class="moon-text" id="moonPhase">Waxing Crescent</span>
                    <span class="moon-sign" id="moonSign">in Scorpio</span>
                </div>
            </div>
            <div class="planetary-hour-widget">
                <div class="planet-icon" id="currentPlanetIcon">â™ƒ</div>
                <div class="planet-details">
                    <span class="planet-label">Planetary Hour</span>
                    <span class="planet-name" id="currentPlanet">Jupiter</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">

        <!-- Dashboard Page - Redesigned -->
        <section class="page active" id="page-dashboard">
            <div class="dashboard-wrapper">
                <!-- Hero Welcome Section -->
                <div class="dashboard-hero">
                    <div class="hero-content">
                        <div class="hero-greeting">
                            <span class="greeting-time" id="greetingTime">Good Morning</span>
                            <h1 class="hero-title">Welcome to <span class="hero-accent">Arcana Flow</span></h1>
                            <p class="hero-subtitle" id="heroSubtitle">The stars align in your favor today</p>
                        </div>
                        <div class="hero-right">
                            <div class="hero-date-widget">
                                <span class="date-day" id="heroDay">08</span>
                                <div class="date-meta">
                                    <span class="date-weekday" id="heroWeekday">Wednesday</span>
                                    <span class="date-month" id="heroMonth">January 2026</span>
                                </div>
                            </div>
                            <div class="hero-stats-compact">
                                <div class="hero-stat">
                                    <i data-lucide="flame"></i>
                                    <span class="hero-stat-value" id="currentStreak">0</span>
                                    <span class="hero-stat-label">Streak</span>
                                </div>
                                <div class="hero-stat">
                                    <i data-lucide="sparkles"></i>
                                    <span class="hero-stat-value" id="todayCompleted">0</span>
                                    <span class="hero-stat-label">Flows</span>
                                </div>
                                <div class="hero-stat">
                                    <i data-lucide="clock"></i>
                                    <span class="hero-stat-value" id="todayTime">0m</span>
                                    <span class="hero-stat-label">Time</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-particles"></div>
                </div>

                <!-- Main Content - Two Column Layout -->
                <div class="dashboard-content">
                    <!-- Left Column - Main Content -->
                    <div class="dashboard-main">
                        <!-- Quick Actions Bar -->
                        <div class="quick-actions-bar">
                            <button class="qa-bar-btn" onclick="openQuickFlow()">
                                <i data-lucide="plus"></i>
                                <span>New Flow</span>
                            </button>
                            <button class="qa-bar-btn" onclick="navigateTo('pomodoro')">
                                <i data-lucide="timer"></i>
                                <span>Pomodoro</span>
                            </button>
                            <button class="qa-bar-btn" onclick="startBreathingExercise()">
                                <i data-lucide="wind"></i>
                                <span>Breathe</span>
                            </button>
                            <button class="qa-bar-btn" onclick="navigateTo('mastery')">
                                <i data-lucide="trophy"></i>
                                <span>Mastery</span>
                            </button>
                            <button class="qa-bar-btn" onclick="openQuickJournal()">
                                <i data-lucide="book-open"></i>
                                <span>Journal</span>
                            </button>
                        </div>

                        <!-- Today's Schedule -->
                        <div class="dash-card schedule-card">
                            <div class="dash-card-header">
                                <div class="header-left">
                                    <span class="header-icon"><i data-lucide="calendar"></i></span>
                                    <h2>Today's Schedule</h2>
                                </div>
                                <span class="schedule-count" id="todayCount">0 items</span>
                            </div>
                            <div class="dash-card-body">
                                <div class="schedule-timeline" id="todaySchedule">
                                    <div class="empty-state-mini">
                                        <i data-lucide="sunrise"></i>
                                        <p>No flows scheduled for today</p>
                                        <button class="btn-mini" onclick="navigateTo('flows')">
                                            <i data-lucide="plus"></i> Create Flow
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Two Column Sub-Grid -->
                        <div class="dashboard-sub-grid">
                            <!-- Priority Tasks -->
                            <div class="dash-card tasks-card">
                                <div class="dash-card-header">
                                    <div class="header-left">
                                        <span class="header-icon"><i data-lucide="check-square"></i></span>
                                        <h2>Priority Tasks</h2>
                                    </div>
                                    <button class="btn-text" onclick="navigateTo('todos')">
                                        View All <i data-lucide="chevron-right"></i>
                                    </button>
                                </div>
                                <div class="dash-card-body">
                                    <div class="priority-tasks-list" id="dashboardTasks">
                                        <div class="empty-state-mini">
                                            <i data-lucide="inbox"></i>
                                            <p>No priority tasks</p>
                                            <button class="btn-mini" onclick="navigateTo('todos')">
                                                <i data-lucide="plus"></i> Add Task
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Active Workings -->
                            <div class="dash-card workings-card">
                                <div class="dash-card-header">
                                    <div class="header-left">
                                        <span class="header-icon"><i data-lucide="wand-2"></i></span>
                                        <h2>Active Workings</h2>
                                    </div>
                                    <button class="btn-text" onclick="navigateTo('magick')">
                                        View All <i data-lucide="chevron-right"></i>
                                    </button>
                                </div>
                                <div class="dash-card-body">
                                    <div class="active-workings-list" id="activeWorkingsList">
                                        <div class="empty-state-mini">
                                            <i data-lucide="sparkles"></i>
                                            <p>No active workings</p>
                                            <button class="btn-mini" onclick="navigateTo('magick')">
                                                <i data-lucide="plus"></i> Start Working
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Sidebar -->
                    <div class="dashboard-sidebar">
                        <!-- Focus Timer Widget -->
                        <div class="dash-card focus-card">
                            <div class="focus-header">
                                <span class="focus-label">Quick Focus</span>
                                <div class="focus-presets">
                                    <button class="focus-preset active" data-minutes="15">15m</button>
                                    <button class="focus-preset" data-minutes="25">25m</button>
                                    <button class="focus-preset" data-minutes="45">45m</button>
                                </div>
                            </div>
                            <div class="focus-display">
                                <div class="focus-ring">
                                    <svg viewBox="0 0 120 120">
                                        <circle class="focus-ring-bg" cx="60" cy="60" r="54" />
                                        <circle class="focus-ring-progress" cx="60" cy="60" r="54" id="focusRingProgress" />
                                    </svg>
                                    <div class="focus-time">
                                        <span class="focus-minutes" id="focusMinutes">15</span>
                                        <span class="focus-label-sm">minutes</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn-focus-start" id="startFocusBtn" onclick="startDashboardFocus()">
                                <i data-lucide="play"></i>
                                <span>Start Focus</span>
                            </button>
                        </div>

                        <!-- Progress & XP -->
                        <div class="dash-card progress-card">
                            <div class="progress-header">
                                <span class="progress-level">Level <span id="dashLevel">1</span></span>
                                <span class="progress-title" id="dashLevelTitle">Neophyte</span>
                            </div>
                            <div class="progress-xp-bar">
                                <div class="progress-xp-fill" id="dashXPBar" style="width: 0%"></div>
                            </div>
                            <span class="progress-xp-text"><span id="dashCurrentXP">0</span> / <span id="dashNextLevelXP">100</span> XP</span>
                            
                            <div class="progress-stats">
                                <div class="progress-stat">
                                    <span class="progress-stat-value" id="activeWorkings">0</span>
                                    <span class="progress-stat-label">Active Workings</span>
                                </div>
                                <div class="progress-stat">
                                    <span class="progress-stat-value" id="todayPomodoros">0</span>
                                    <span class="progress-stat-label">Pomodoros Today</span>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="dash-card activity-card">
                            <div class="dash-card-header compact">
                                <div class="header-left">
                                    <span class="header-icon"><i data-lucide="activity"></i></span>
                                    <h2>Activity</h2>
                                </div>
                            </div>
                            <div class="dash-card-body">
                                <div class="activity-feed" id="dashboardActivity">
                                    <div class="empty-state-mini">
                                        <i data-lucide="clock"></i>
                                        <p>No recent activity</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cosmic Insight Banner -->
                <div class="cosmic-insight-banner">
                    <div class="insight-glow"></div>
                    <div class="insight-content">
                        <div class="insight-icon">
                            <i data-lucide="sparkles"></i>
                        </div>
                        <div class="insight-text">
                            <span class="insight-label">Cosmic Insight</span>
                            <p class="insight-message" id="cosmicInsight">The Moon waxes in a favorable sign. A good time for new beginnings and setting intentions.</p>
                        </div>
                    </div>
                    <button class="insight-refresh" onclick="refreshCosmicInsight()" title="New Insight">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Flows Page -->
        <section class="page" id="page-flows">
            <header class="page-header">
                <h1 class="page-title">Flows</h1>
                <div class="header-actions">
                    <button id="importFlowBtn" class="btn btn-outline" onclick="window.triggerFlowImport()">
                        <span><i data-lucide="upload"></i> Import Flow</span>
                    </button>
                    <button class="btn btn-outline" onclick="openExportFlowModal()">
                        <span><i data-lucide="download"></i> Export Flows</span>
                    </button>
                    <button class="btn btn-gold" onclick="openFlowBuilder()">
                        <span><i data-lucide="plus"></i> Create Flow</span>
                    </button>
                </div>
            </header>

            <div class="flows-tabs">
                <button class="tab-btn active" data-tab="all-flows">My Flows</button>
                <button class="tab-btn" data-tab="templates">Templates Library</button>
            </div>

            <div class="flows-content active" id="tab-all-flows">
                <div class="flows-grid" id="flowsGrid">
                    <!-- Flows will be populated here -->
                </div>
                <div class="empty-state" id="noFlows">
                    <span class="empty-icon"><i data-lucide="workflow"></i></span>
                    <h3>No flows created yet</h3>
                    <p>Create your first flow to begin your practice</p>
                    <button class="btn btn-gold" onclick="openFlowBuilder()">Create Flow</button>
                </div>
            </div>

            <div class="flows-content" id="tab-templates" style="display: none;">
                <div class="templates-grid" id="templatesGrid">
                    <!-- Templates populated via JS -->
                </div>
            </div>
        </section>

        <!-- Magick Workings Page - Redesigned -->
        <section class="page" id="page-magick">
            <div class="workings-page-wrapper">
                <!-- Header -->
                <header class="workings-header">
                    <div class="workings-header-left">
                        <h1 class="workings-title">
                            <span class="title-icon"><i data-lucide="sparkles"></i></span>
                            Magick Workings
                        </h1>
                        <p class="workings-subtitle">Track your manifestations and spiritual practices</p>
                    </div>
                    <button class="btn-new-working" onclick="openWorkingBuilder()">
                        <span class="btn-icon"><i data-lucide="plus"></i></span>
                        <span class="btn-text">New Working</span>
                    </button>
                </header>

                <!-- Stats Overview -->
                <div class="workings-stats-row">
                    <div class="working-stat-card">
                        <span class="stat-icon"><i data-lucide="wand-2"></i></span>
                        <div class="stat-info">
                            <span class="stat-value" id="workingsActiveCount">0</span>
                            <span class="stat-label">Active</span>
                        </div>
                    </div>
                    <div class="working-stat-card">
                        <span class="stat-icon"><i data-lucide="clipboard-list"></i></span>
                        <div class="stat-info">
                            <span class="stat-value" id="workingsPlannedCount">0</span>
                            <span class="stat-label">Planned</span>
                        </div>
                    </div>
                    <div class="working-stat-card">
                        <span class="stat-icon"><i data-lucide="trophy"></i></span>
                        <div class="stat-info">
                            <span class="stat-value" id="workingsCompletedCount">0</span>
                            <span class="stat-label">Completed</span>
                        </div>
                    </div>
                    <div class="working-stat-card highlight">
                        <span class="stat-icon"><i data-lucide="flame"></i></span>
                        <div class="stat-info">
                            <span class="stat-value" id="workingsStreak">0</span>
                            <span class="stat-label">Day Streak</span>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="workings-tabs-new">
                    <button class="working-tab active" data-tab="active">
                        <span class="tab-icon"><i data-lucide="zap"></i></span>
                        <span class="tab-label">Active</span>
                        <span class="tab-count" id="tabActiveCount">0</span>
                    </button>
                    <button class="working-tab" data-tab="planned">
                        <span class="tab-icon"><i data-lucide="file-text"></i></span>
                        <span class="tab-label">Planned</span>
                        <span class="tab-count" id="tabPlannedCount">0</span>
                    </button>
                    <button class="working-tab" data-tab="completed">
                        <span class="tab-icon"><i data-lucide="check"></i></span>
                        <span class="tab-label">Completed</span>
                        <span class="tab-count" id="tabCompletedCount">0</span>
                    </button>
                </div>

                <!-- Workings Grid -->
                <div class="workings-grid-new" id="workingsGrid">
                    <!-- Workings will be populated here -->
                </div>

                <!-- Empty State -->
                <div class="workings-empty-state" id="noWorkings">
                    <div class="empty-sigil"><i data-lucide="sparkles"></i></div>
                    <h3>No Active Workings</h3>
                    <p>Begin your magical journey by creating a new working</p>
                    <button class="btn-new-working" onclick="openWorkingBuilder()">
                        <span class="btn-icon"><i data-lucide="plus"></i></span>
                        <span>Create Working</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Tasks Page - Redesigned -->
        <section class="page" id="page-todos">
            <div class="tasks-page-wrapper">
                <!-- Tasks Header -->
                <header class="tasks-header">
                    <div class="tasks-header-left">
                        <h1 class="tasks-title">
                            <span class="title-icon"><i data-lucide="clipboard-list"></i></span>
                            Tasks
                        </h1>
                        <div class="tasks-quick-stats">
                            <span class="quick-stat" id="tasksQuickTotal">
                                <span class="stat-num">0</span> total
                            </span>
                            <span class="quick-stat-divider">â€¢</span>
                            <span class="quick-stat done-stat" id="tasksQuickDone">
                                <span class="stat-num">0</span> done today
                            </span>
                        </div>
                    </div>
                    <button class="btn-add-task" onclick="openTaskModal()">
                        <span class="btn-icon"><i data-lucide="plus"></i></span>
                        <span class="btn-text">Add Task</span>
                    </button>
                </header>

                <!-- Search & Filters Bar -->
                <div class="tasks-toolbar">
                    <div class="tasks-search">
                        <span class="search-icon"><i data-lucide="search"></i></span>
                        <input type="text" id="taskSearch" placeholder="Search tasks..." oninput="renderTasks()">
                    </div>
                    <div class="tasks-filters">
                        <div class="filter-group">
                            <select id="taskCategoryFilter" class="filter-select" onchange="renderTasks()">
                                <option value="">All Categories</option>
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                                <option value="health">Health</option>
                                <option value="study">Study</option>
                                <option value="spiritual">Spiritual</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="taskPriorityFilter" class="filter-select" onchange="renderTasks()">
                                <option value="">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <button class="filter-clear-btn" onclick="clearTaskFilters()" title="Clear filters">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>

                <!-- Kanban Board -->
                <div class="tasks-board">
                    <!-- To Do Column -->
                    <div class="tasks-column" data-status="todo">
                        <div class="column-header todo-header">
                            <div class="column-header-left">
                                <span class="column-icon"><i data-lucide="file-text"></i></span>
                                <span class="column-title">To Do</span>
                            </div>
                            <span class="column-count" id="todoCount">0</span>
                        </div>
                        <div class="tasks-list" id="todoList" data-status="todo">
                            <!-- Tasks populated here -->
                        </div>
                        <button class="add-task-inline" onclick="openTaskModal('todo')">
                            <span><i data-lucide="plus"></i> Add task</span>
                        </button>
                    </div>

                    <!-- In Progress Column -->
                    <div class="tasks-column" data-status="progress">
                        <div class="column-header progress-header">
                            <div class="column-header-left">
                                <span class="column-icon"><i data-lucide="zap"></i></span>
                                <span class="column-title">In Progress</span>
                            </div>
                            <span class="column-count" id="progressCount">0</span>
                        </div>
                        <div class="tasks-list" id="progressList" data-status="progress">
                            <!-- Tasks populated here -->
                        </div>
                        <button class="add-task-inline" onclick="openTaskModal('progress')">
                            <span><i data-lucide="plus"></i> Add task</span>
                        </button>
                    </div>

                    <!-- Done Column -->
                    <div class="tasks-column" data-status="done">
                        <div class="column-header done-header">
                            <div class="column-header-left">
                                <span class="column-icon"><i data-lucide="check-circle"></i></span>
                                <span class="column-title">Done</span>
                            </div>
                            <span class="column-count" id="doneCount">0</span>
                        </div>
                        <div class="tasks-list" id="doneList" data-status="done">
                            <!-- Tasks populated here -->
                        </div>
                        <button class="clear-done-btn" onclick="clearDoneTasks()" id="clearDoneBtn" style="display:none;">
                            <i data-lucide="trash-2"></i> Clear completed
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pomodoro Page -->
        <section class="page" id="page-pomodoro">
            <div class="pomo-page-wrapper">
                <!-- Main Timer Area -->
                <div class="pomo-main">
                    <div class="pomo-ambient-bg" id="pomoAmbient"></div>
                    
                    <!-- Mode Tabs -->
                    <div class="pomo-mode-tabs">
                        <button class="pomo-tab active" data-mode="work">
                            <span class="tab-icon"><i data-lucide="target"></i></span>
                            <span class="tab-label">Focus</span>
                        </button>
                        <button class="pomo-tab" data-mode="short">
                            <span class="tab-icon"><i data-lucide="coffee"></i></span>
                            <span class="tab-label">Short Break</span>
                        </button>
                        <button class="pomo-tab" data-mode="long">
                            <span class="tab-icon"><i data-lucide="leaf"></i></span>
                            <span class="tab-label">Long Break</span>
                        </button>
                    </div>

                    <!-- Timer Circle -->
                    <div class="pomo-timer-wrapper">
                        <div class="pomo-ring-container">
                            <svg class="pomo-ring-svg" viewBox="0 0 280 280" style="overflow: visible;">
                                <defs>
                                    <linearGradient id="pomoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:var(--pomo-color-start, #d4af37)"/>
                                        <stop offset="100%" style="stop-color:var(--pomo-color-end, #f5d77a)"/>
                                    </linearGradient>
                                </defs>
                                <circle class="pomo-ring-track" cx="140" cy="140" r="130"/>
                                <circle class="pomo-ring-progress" cx="140" cy="140" r="130" id="pomoRingProgress"/>
                            </svg>
                            <div class="pomo-timer-inner">
                                <div class="pomo-status" id="pomoStatus">Ready to Focus</div>
                                <div class="pomo-time" id="pomoTimeDisplay">25:00</div>
                                <div class="pomo-session-label" id="pomoSessionLabel">Session 1 of 4</div>
                            </div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="pomo-controls">
                        <button class="pomo-ctrl-btn" onclick="skipPomodoro()" title="Skip">
                            <span><i data-lucide="skip-forward"></i></span>
                        </button>
                        <button class="pomo-ctrl-btn main-btn" id="pomoPlayBtn" onclick="togglePomodoro()">
                            <span id="pomoPlayIcon"><i data-lucide="play"></i></span>
                        </button>
                        <button class="pomo-ctrl-btn" onclick="resetPomodoro()" title="Reset">
                            <span><i data-lucide="rotate-ccw"></i></span>
                        </button>
                    </div>

                    <!-- Linked Goal Pill -->
                    <div class="pomo-linked-pill" id="pomoLinkedPill" style="display:none;">
                        <span class="linked-dot" id="pomoLinkedDot"></span>
                        <span id="pomoLinkedName">Linked Goal</span>
                        <button class="linked-clear" onclick="clearPomoLink()" title="Unlink"><i data-lucide="x"></i></button>
                    </div>
                </div>

                <!-- Side Panel -->
                <div class="pomo-side-panel">
                    <!-- Today's Progress -->
                    <div class="pomo-panel-section">
                        <h3 class="panel-title">Today's Progress</h3>
                        <div class="pomo-today-stats">
                            <div class="today-stat-card">
                                <div class="stat-ring-mini">
                                    <svg viewBox="0 0 40 40">
                                        <circle cx="20" cy="20" r="16" class="stat-ring-bg"/>
                                        <circle cx="20" cy="20" r="16" class="stat-ring-fill" id="todayProgressRing"/>
                                    </svg>
                                    <span class="stat-ring-val" id="todayPomos">0</span>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-label">Sessions</span>
                                    <span class="stat-goal" id="todayGoalText">Goal: 4</span>
                                </div>
                            </div>
                            <div class="today-stat-card">
                                <div class="stat-icon"><i data-lucide="timer"></i></div>
                                <div class="stat-info">
                                    <span class="stat-value" id="todayMinutes">0</span>
                                    <span class="stat-label">Minutes</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Settings -->
                    <div class="pomo-panel-section">
                        <h3 class="panel-title">Timer Settings</h3>
                        <div class="pomo-quick-settings">
                            <div class="quick-setting">
                                <label>Focus</label>
                                <div class="setting-adjuster">
                                    <button onclick="adjustPomoSetting('work', -5)">âˆ’</button>
                                    <span id="workDurationDisplay">25</span>
                                    <button onclick="adjustPomoSetting('work', 5)">+</button>
                                </div>
                            </div>
                            <div class="quick-setting">
                                <label>Short Break</label>
                                <div class="setting-adjuster">
                                    <button onclick="adjustPomoSetting('short', -1)">âˆ’</button>
                                    <span id="shortBreakDisplay">5</span>
                                    <button onclick="adjustPomoSetting('short', 1)">+</button>
                                </div>
                            </div>
                            <div class="quick-setting">
                                <label>Long Break</label>
                                <div class="setting-adjuster">
                                    <button onclick="adjustPomoSetting('long', -5)">âˆ’</button>
                                    <span id="longBreakDisplay">15</span>
                                    <button onclick="adjustPomoSetting('long', 5)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Link to Mastery -->
                    <div class="pomo-panel-section">
                        <h3 class="panel-title">Link to Goal</h3>
                        <select id="pomoMasterySelect" class="pomo-select">
                            <option value="">No goal linked</option>
                        </select>
                        <p class="pomo-hint">Focus time will count toward your mastery goal</p>
                    </div>

                    <!-- Lifetime Stats -->
                    <div class="pomo-panel-section">
                        <h3 class="panel-title">All Time</h3>
                        <div class="pomo-lifetime-stats">
                            <div class="lifetime-stat">
                                <span class="lifetime-val" id="totalPomoSessions">0</span>
                                <span class="lifetime-label">Total Sessions</span>
                            </div>
                            <div class="lifetime-stat">
                                <span class="lifetime-val" id="totalPomoHours">0</span>
                                <span class="lifetime-label">Hours Focused</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mastery Page - Redesigned -->
        <section class="page" id="page-mastery">
            <header class="page-header mastery-header">
                <div class="mastery-header-content">
                    <h1 class="page-title">Mastery Journey</h1>
                    <p class="mastery-subtitle">Track your path to expertise â€¢ 10,000 hours and beyond</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="toggleMasteryView()">
                        <span id="masteryViewIcon"><i data-lucide="layout-grid"></i></span>
                    </button>
                    <button class="btn btn-gold" onclick="openMasteryModal()">
                        <span><i data-lucide="plus"></i> New Goal</span>
                    </button>
                </div>
            </header>

            <!-- Mastery Stats Overview -->
            <div class="mastery-overview" id="masteryOverview">
                <div class="mastery-stat-card">
                    <div class="mstat-icon"><i data-lucide="target"></i></div>
                    <div class="mstat-content">
                        <span class="mstat-value" id="totalMasteryGoals">0</span>
                        <span class="mstat-label">Active Goals</span>
                    </div>
                </div>
                <div class="mastery-stat-card">
                    <div class="mstat-icon"><i data-lucide="clock"></i></div>
                    <div class="mstat-content">
                        <span class="mstat-value" id="totalMasteryHours">0h</span>
                        <span class="mstat-label">Total Hours</span>
                    </div>
                </div>
                <div class="mastery-stat-card">
                    <div class="mstat-icon"><i data-lucide="flame"></i></div>
                    <div class="mstat-content">
                        <span class="mstat-value" id="masteryStreak">0</span>
                        <span class="mstat-label">Day Streak</span>
                    </div>
                </div>
                <div class="mastery-stat-card">
                    <div class="mstat-icon"><i data-lucide="trophy"></i></div>
                    <div class="mstat-content">
                        <span class="mstat-value" id="completedMasteries">0</span>
                        <span class="mstat-label">Mastered</span>
                    </div>
                </div>
            </div>

            <!-- View Toggle Tabs -->
            <div class="mastery-tabs">
                <button class="mastery-tab active" data-tab="active" onclick="switchMasteryTab('active')">
                    <span class="tab-icon"><i data-lucide="zap"></i></span> In Progress
                </button>
                <button class="mastery-tab" data-tab="completed" onclick="switchMasteryTab('completed')">
                    <span class="tab-icon"><i data-lucide="trophy"></i></span> Completed
                </button>
                <button class="mastery-tab" data-tab="archived" onclick="switchMasteryTab('archived')">
                    <span class="tab-icon"><i data-lucide="archive"></i></span> Archived
                </button>
            </div>

            <!-- Main Mastery Grid -->
            <div class="mastery-content">
                <div class="mastery-grid-new" id="masteryGrid">
                    <!-- Mastery goals populated here -->
                </div>

                <div class="empty-state mastery-empty" id="noMastery">
                    <div class="empty-illustration">
                        <div class="empty-orbit">
                            <span class="orbit-dot"></span>
                            <span class="orbit-dot"></span>
                            <span class="orbit-dot"></span>
                        </div>
                        <span class="empty-icon-large"><i data-lucide="star"></i></span>
                    </div>
                    <h3>Begin Your Mastery Journey</h3>
                    <p>The journey of 10,000 hours begins with a single step.<br>Track any skill, habit, or discipline.</p>
                    <div class="empty-features">
                        <div class="empty-feature"><span><i data-lucide="timer"></i></span> Time tracking</div>
                        <div class="empty-feature"><span><i data-lucide="hash"></i></span> Rep counting</div>
                        <div class="empty-feature"><span><i data-lucide="bar-chart-3"></i></span> Progress milestones</div>
                    </div>
                    <button class="btn btn-gold btn-lg" onclick="openMasteryModal()">
                        <span><i data-lucide="sparkles"></i></span> Create First Goal
                    </button>
                </div>

                <!-- Completed Section -->
                <div class="mastery-grid-new" id="masteryCompletedGrid" style="display:none;">
                    <!-- Completed mastery goals -->
                </div>

                <!-- Archived Section -->
                <div class="mastery-grid-new" id="masteryArchivedGrid" style="display:none;">
                    <!-- Archived mastery goals -->
                </div>
            </div>
        </section>

        <!-- Weekly Schedule Page -->
        <section class="page" id="page-weekly-schedule">
            <header class="page-header">
                <h1 class="page-title">Weekly Schedule</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="resetWeeklyChecks()" title="Reset all checkboxes">
                        <i data-lucide="refresh-cw"></i> Reset
                    </button>
                    <button class="btn btn-gold" onclick="openRoutineModal()">
                        <i data-lucide="plus"></i> New Routine
                    </button>
                </div>
            </header>

            <div class="schedule-page-layout">
                <!-- Week Overview Grid - Main Focus -->
                <div class="week-overview-panel">
                    <div class="week-nav-header">
                        <h3>Week Overview</h3>
                        <span class="week-identifier" id="weekIdentifier">Week 2, 2026</span>
                    </div>

                    <div class="week-days-grid">
                        <!-- Monday -->
                        <div class="week-day-column" data-day="monday">
                            <div class="day-column-header">
                                <span class="day-short">Mon</span>
                                <span class="day-date" id="mondayDate">6</span>
                            </div>
                            <div class="day-routines-container" id="monday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('monday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>

                        <!-- Tuesday -->
                        <div class="week-day-column" data-day="tuesday">
                            <div class="day-column-header">
                                <span class="day-short">Tue</span>
                                <span class="day-date" id="tuesdayDate">7</span>
                            </div>
                            <div class="day-routines-container" id="tuesday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('tuesday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>

                        <!-- Wednesday -->
                        <div class="week-day-column" data-day="wednesday">
                            <div class="day-column-header">
                                <span class="day-short">Wed</span>
                                <span class="day-date" id="wednesdayDate">8</span>
                            </div>
                            <div class="day-routines-container" id="wednesday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('wednesday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>

                        <!-- Thursday -->
                        <div class="week-day-column" data-day="thursday">
                            <div class="day-column-header">
                                <span class="day-short">Thu</span>
                                <span class="day-date" id="thursdayDate">9</span>
                            </div>
                            <div class="day-routines-container" id="thursday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('thursday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>

                        <!-- Friday -->
                        <div class="week-day-column" data-day="friday">
                            <div class="day-column-header">
                                <span class="day-short">Fri</span>
                                <span class="day-date" id="fridayDate">10</span>
                            </div>
                            <div class="day-routines-container" id="friday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('friday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>

                        <!-- Saturday -->
                        <div class="week-day-column weekend" data-day="saturday">
                            <div class="day-column-header">
                                <span class="day-short">Sat</span>
                                <span class="day-date" id="saturdayDate">11</span>
                            </div>
                            <div class="day-routines-container" id="saturday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('saturday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>

                        <!-- Sunday -->
                        <div class="week-day-column weekend" data-day="sunday">
                            <div class="day-column-header">
                                <span class="day-short">Sun</span>
                                <span class="day-date" id="sundayDate">12</span>
                            </div>
                            <div class="day-routines-container" id="sunday-routines"></div>
                            <button class="day-add-btn" onclick="openRoutineModal('sunday')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bottom: Today's Focus Sidebar -->
                <div class="today-focus-panel">
                    <div class="today-focus-header">
                        <div class="today-date-badge">
                            <span class="today-day-num" id="ritualDayNum">8</span>
                            <span class="today-day-name" id="ritualDayName">Thu</span>
                        </div>
                        <div class="today-title-area">
                            <h3>Today's Schedule</h3>
                            <span class="today-full-date" id="ritualFullDate">Thursday, January 8</span>
                        </div>
                        <div class="today-progress-compact">
                            <svg class="progress-ring-mini" viewBox="0 0 44 44">
                                <circle class="ring-bg" cx="22" cy="22" r="18" />
                                <circle class="ring-fill" id="sacredProgressRing" cx="22" cy="22" r="18" />
                            </svg>
                            <span class="progress-percent" id="sacredProgressPercent">0%</span>
                        </div>
                    </div>
                    
                    <div class="today-routines-list" id="todayRitualsList">
                        <!-- Populated by JS -->
                    </div>
                    
                    <div class="today-stats-row">
                        <div class="mini-stat">
                            <span class="mini-stat-value" id="ritualsCompletedToday">0</span>
                            <span class="mini-stat-label">Done</span>
                        </div>
                        <div class="mini-stat">
                            <span class="mini-stat-value" id="ritualsRemainingToday">0</span>
                            <span class="mini-stat-label">Left</span>
                        </div>
                        <div class="mini-stat">
                            <span class="mini-stat-value" id="totalWeeklyRituals">0</span>
                            <span class="mini-stat-label">This Week</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calendar Page -->
        <section class="page" id="page-calendar">
            <header class="page-header">
                <h1 class="page-title">Calendar</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="openExportPDFModal('calendar')" title="Export to PDF"><i data-lucide="file-text"></i>
                        Export</button>
                    <button class="btn btn-outline" id="calendarPrev"><i data-lucide="chevron-left"></i></button>
                    <span class="calendar-month" id="calendarMonth">December 2025</span>
                    <button class="btn btn-outline" id="calendarNext"><i data-lucide="chevron-right"></i></button>
                </div>
            </header>

            <div class="calendar-container">
                <div class="calendar-grid">
                    <div class="calendar-header">
                        <span>Sun</span>
                        <span>Mon</span>
                        <span>Tue</span>
                        <span>Wed</span>
                        <span>Thu</span>
                        <span>Fri</span>
                        <span>Sat</span>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                        <!-- Days populated here -->
                    </div>
                </div>

                <div class="calendar-sidebar">
                    <div class="calendar-day-detail" id="calendarDetail">
                        <h3 id="selectedDateTitle">Select a date</h3>
                        <div class="day-events" id="dayEvents">
                            <p class="hint">Click on a date to see scheduled items and journal entries</p>
                        </div>
                        <div class="quick-add-container" id="calendarQuickAdd" style="display:none">
                            <button class="btn btn-sm btn-outline" onclick="quickScheduleFlow()"><i data-lucide="plus"></i> Schedule
                                Flow</button>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card recent-activity">
                    <div class="card-header">
                        <h2>Recent Activity</h2>
                        <span class="badge">History</span>
                    </div>
                    <div class="card-content">
                        <div class="activity-log" id="activityLogList">
                            <!-- Activity items will be injected here -->
                            <div class="text-muted" style="text-align:center; padding: 20px;">Loading activity...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Journal Page -->
        <section class="page" id="page-journal">
            <header class="page-header">
                <h1 class="page-title">Journal</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="openExportPDFModal('journal')" title="Export to PDF"><i data-lucide="file-text"></i>
                        Export</button>
                    <button class="btn btn-gold" onclick="openJournalEntry()">
                        <span><i data-lucide="plus"></i> New Entry</span>
                    </button>
                </div>
            </header>

            <!-- Journal Filters -->
            <div class="journal-filters" style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                <input type="text" id="journalSearch" class="input" placeholder="Search entries..."
                    style="flex: 1; min-width: 200px;" oninput="filterJournal()">
                <select id="journalMoodFilter" class="input" style="width: 150px;" onchange="filterJournal()">
                    <option value="">All Moods</option>
                    <option value="great">Great</option>
                    <option value="good">Good</option>
                    <option value="neutral">Neutral</option>
                    <option value="low">Low</option>
                    <option value="bad">Bad</option>
                </select>
                <input type="date" id="journalDateFilter" class="input" style="width: 160px;"
                    onchange="filterJournal()">
            </div>

            <div class="journal-container">
                <div class="journal-list" id="journalList">
                    <!-- Journal entries populated here -->
                </div>
            </div>

            <div class="empty-state" id="noJournal">
                <span class="empty-icon"><i data-lucide="book-open"></i></span>
                <h3>No journal entries yet</h3>
                <p>Record your thoughts, insights, and progress</p>
                <button class="btn btn-gold" onclick="openJournalEntry()">Write Entry</button>
            </div>
        </section>

        <!-- Statistics Page -->
        <section class="page" id="page-stats">
            <header class="page-header">
                <h1 class="page-title">Statistics</h1>
                <div class="header-actions">
                    <select id="statsRange" class="select-input">
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                        <option value="all">All Time</option>
                    </select>
                </div>
            </header>

            <div class="stats-overview">
                <div class="stat-card large">
                    <div class="stat-content">
                        <span class="stat-value" id="totalFlows">0</span>
                        <span class="stat-label">Total Flows Completed</span>
                    </div>
                </div>
                <div class="stat-card large">
                    <div class="stat-content">
                        <span class="stat-value" id="totalTime">0h</span>
                        <span class="stat-label">Total Practice Time</span>
                    </div>
                </div>
                <div class="stat-card large">
                    <div class="stat-content">
                        <span class="stat-value" id="totalReps">0</span>
                        <span class="stat-label">Total Repetitions</span>
                    </div>
                </div>
                <div class="stat-card large">
                    <div class="stat-content">
                        <span class="stat-value" id="longestStreak">0</span>
                        <span class="stat-label">Longest Streak</span>
                    </div>
                </div>
            </div>

            <!-- Badges Section -->
            <div class="card badges-section">
                <div class="card-header">
                    <h2>Achievements</h2>
                </div>
                <div class="card-content">
                    <div class="badges-grid" id="badgesGrid">
                        <!-- Badges populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Page -->
        <section class="page" id="page-settings">
            <header class="page-header">
                <h1 class="page-title">Settings</h1>
            </header>

            <div class="settings-container">
                <div class="card settings-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Location & Astronomy</h3>
                    <p class="settings-hint">Set your location for accurate Planetary Hour calculations.</p>
                    <div class="settings-row" style="display:flex; gap:10px; align-items:center;">
                        <div style="flex:1;">
                            <input type="text" id="locationSearch" placeholder="Search City (e.g. London, UK)"
                                class="input">
                        </div>
                        <button class="btn btn-gold" onclick="searchLocation()">Search</button>
                    </div>
                    <div id="locationResult"
                        style="margin-top:15px; padding:10px; background:rgba(255,255,255,0.05); border-radius:6px; display:none;">
                        <!-- Result populated by JS -->
                    </div>
                </div>

                <div class="card settings-section">
                    <h3>Data Management</h3>
                    <div class="settings-row">
                        <div class="setting-info">
                            <span class="setting-title">Export All Data</span>
                            <span class="setting-desc">Download all your data as a JSON file</span>
                        </div>
                        <button class="btn btn-outline" onclick="exportAllData()">Export</button>
                    </div>
                    <div class="settings-row">
                        <div class="setting-info">
                            <span class="setting-title">Import Data</span>
                            <span class="setting-desc">Import data from a backup file</span>
                        </div>
                        <button class="btn btn-outline" onclick="triggerSelectiveImport()">Import</button>
                    </div>
                    <div class="settings-row danger">
                        <div class="setting-info">
                            <span class="setting-title">Clear All Data</span>
                            <span class="setting-desc">Permanently delete all data</span>
                        </div>
                        <button class="btn btn-danger" onclick="confirmClearData()">Clear Data</button>
                    </div>
                </div>

                <div class="card settings-section">
                    <h3>Preferences</h3>
                    <div class="settings-row">
                        <div class="setting-info">
                            <span class="setting-title">Sound Effects</span>
                            <span class="setting-desc">Play sounds for timer completions</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="soundEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-row">
                        <div class="setting-info">
                            <span class="setting-title">Haptic Feedback</span>
                            <span class="setting-desc">Vibrate on mobile devices</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="hapticEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-row">
                        <div class="setting-info">
                            <span class="setting-title">Notifications</span>
                            <span class="setting-desc">Browser notifications for reminders</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="notificationsEnabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-row">
                        <div class="setting-info">
                            <span class="setting-title">Animations</span>
                            <span class="setting-desc">Enable particle effects and animations</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="animationsEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="card settings-section">
                    <h3>About</h3>
                    <div class="about-info">
                        <p><strong>Arcana Flow</strong> - Mystical Productivity Tool</p>
                        <p>Version 1.5.0</p>
                        <p class="hint">All data is stored locally in your browser.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Flow Builder Modal -->
    <div class="modal" id="flowBuilderModal">
        <div class="modal-overlay" onclick="closeModal('flowBuilderModal')"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="flowBuilderTitle">Create New Flow</h2>
                <button class="modal-close" onclick="closeModal('flowBuilderModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Flow Name</label>
                    <input type="text" id="flowName" placeholder="e.g., Morning Ritual" class="input">
                </div>
                <div class="form-group">
                    <label>Description (optional)</label>
                    <textarea id="flowDescription" placeholder="Describe your flow..." class="input"></textarea>
                </div>
                <div class="form-group">
                    <label>Cover Image (optional)</label>
                    <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px;">
                        <select id="flowCoverPreset" class="input" style="flex:1; min-width:150px;"
                            onchange="applyCoverImagePreset(this.value)">
                            <option value="">Choose Preset...</option>
                        </select>
                        <span style="color:#666; font-size:0.8rem;">or</span>
                        <input type="file" id="flowImage" accept="image/*" class="input"
                            style="flex:1; min-width:150px;" onchange="handleFlowCoverUpload(this)">
                    </div>
                    <div id="flowImagePreview"
                        style="margin-top:10px; display:none; width:100%; height:150px; background-size:cover; background-position:center; border-radius:6px; position:relative;">
                        <button onclick="clearCoverImage()"
                            style="position:absolute; top:5px; right:5px; background:rgba(0,0,0,0.7); color:white; border:none; border-radius:4px; padding:2px 8px; cursor:pointer; font-size:0.75rem;"><i data-lucide="x" style="width:12px;height:12px;"></i>
                            Clear</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Schedule</label>
                    <select id="flowSchedule" class="input">
                        <option value="manual">Manual (No Schedule)</option>
                        <option value="daily">Daily</option>
                        <option value="weekdays">Weekdays</option>
                        <option value="weekends">Weekends</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="specific">Specific Date</option>
                    </select>
                </div>

                <div class="form-group schedule-options" id="weeklyOptions" style="display:none">
                    <label>Select Days</label>
                    <div class="day-selector">
                        <label><input type="checkbox" value="0"> Sun</label>
                        <label><input type="checkbox" value="1"> Mon</label>
                        <label><input type="checkbox" value="2"> Tue</label>
                        <label><input type="checkbox" value="3"> Wed</label>
                        <label><input type="checkbox" value="4"> Thu</label>
                        <label><input type="checkbox" value="5"> Fri</label>
                        <label><input type="checkbox" value="6"> Sat</label>
                    </div>
                </div>

                <div class="form-group schedule-options" id="specificDateOption" style="display:none">
                    <label>Select Date</label>
                    <input type="date" id="flowSpecificDate" class="input">
                </div>

                <div class="form-group">
                    <label>Link to Mastery Goal (optional)</label>
                    <select id="flowMasteryLink" class="input">
                        <option value="">None</option>
                    </select>
                </div>

                <div class="components-builder">
                    <div class="components-header">
                        <h3>Flow Components</h3>
                        <div class="component-buttons">
                            <button class="btn btn-sm btn-outline" onclick="addComponent('timer')"><i data-lucide="plus"></i> Timer</button>
                            <button class="btn btn-sm btn-outline" onclick="addComponent('stopwatch')"><i data-lucide="plus"></i>
                                Stopwatch</button>
                            <button class="btn btn-sm btn-outline" onclick="addComponent('reps')"><i data-lucide="plus"></i> Rep Counter</button>
                            <button class="btn btn-sm btn-outline" onclick="addComponent('breathing')"><i data-lucide="plus"></i>
                                Breathing</button>
                        </div>
                    </div>
                    <div class="components-list" id="componentsList">
                        <div class="empty-components">
                            <p>Add components to build your flow</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('flowBuilderModal')">Cancel</button>
                <button class="btn btn-gold" onclick="saveFlow()">Save Flow</button>
            </div>
        </div>
    </div>

    <!-- Working Builder Modal -->
    <!-- Working Builder Modal - Redesigned -->
    <div class="modal" id="workingBuilderModal">
        <div class="modal-overlay" onclick="closeModal('workingBuilderModal')"></div>
        <div class="modal-content working-modal-content">
            <div class="modal-header working-modal-header">
                <div class="modal-header-left">
                    <span class="modal-icon"><i data-lucide="sparkles"></i></span>
                    <h2 id="workingModalTitle">Create Magick Working</h2>
                </div>
                <button class="modal-close" onclick="closeModal('workingBuilderModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body working-modal-body">
                <!-- Working Name -->
                <div class="form-group working-name-group">
                    <input type="text" id="workingName" placeholder="Name your Working..." class="working-name-input" autocomplete="off">
                </div>

                <!-- Duration Presets -->
                <div class="form-group">
                    <label class="working-label">Duration</label>
                    <div class="duration-presets">
                        <button type="button" class="duration-preset" data-days="7">
                            <span class="preset-num">7</span>
                            <span class="preset-label">days</span>
                        </button>
                        <button type="button" class="duration-preset" data-days="21">
                            <span class="preset-num">21</span>
                            <span class="preset-label">days</span>
                        </button>
                        <button type="button" class="duration-preset active" data-days="40">
                            <span class="preset-num">40</span>
                            <span class="preset-label">days</span>
                        </button>
                        <button type="button" class="duration-preset" data-days="90">
                            <span class="preset-num">90</span>
                            <span class="preset-label">days</span>
                        </button>
                        <div class="duration-custom">
                            <input type="number" id="workingDuration" value="40" min="1" max="365" class="duration-input">
                            <span class="duration-suffix">days</span>
                        </div>
                    </div>
                </div>

                <!-- Intention -->
                <div class="form-group">
                    <label class="working-label">
                        <span class="label-icon"><i data-lucide="target"></i></span>
                        Intention / Goal
                    </label>
                    <textarea id="workingIntention" placeholder="What do you wish to manifest or achieve?" class="working-textarea" rows="3"></textarea>
                </div>

                <!-- Affirmation -->
                <div class="form-group">
                    <label class="working-label">
                        <span class="label-icon"><i data-lucide="sparkle"></i></span>
                        Affirmation <span class="label-optional">(optional)</span>
                    </label>
                    <textarea id="workingAffirmation" placeholder="I am... I have... I attract..." class="working-textarea affirmation-input" rows="2"></textarea>
                </div>

                <!-- Start Date & Image Row -->
                <div class="working-details-row">
                    <div class="form-group">
                        <label class="working-label">
                            <span class="label-icon"><i data-lucide="calendar"></i></span>
                            Start Date
                        </label>
                        <input type="date" id="workingStartDate" class="working-date-input">
                    </div>
                    <div class="form-group working-image-group">
                        <label class="working-label">
                            <span class="label-icon"><i data-lucide="image"></i></span>
                            Sigil / Image <span class="label-optional">(optional)</span>
                        </label>
                        <div class="image-upload-area" id="workingImageUploadArea">
                            <input type="file" id="workingImageFile" accept="image/*" onchange="handleWorkingImageUpload(this)">
                            <div class="upload-placeholder" id="uploadPlaceholder">
                                <span class="upload-icon"><i data-lucide="camera"></i></span>
                                <span>Upload sigil</span>
                            </div>
                            <div class="image-preview" id="workingImagePreview" style="display:none;">
                                <img id="workingImagePreviewImg">
                                <button type="button" class="image-remove-btn" onclick="clearWorkingImage()"><i data-lucide="x"></i></button>
                            </div>
                        </div>
                        <input type="hidden" id="workingImage" value="">
                    </div>
                </div>
            </div>
            <div class="modal-footer working-modal-footer">
                <button class="btn btn-outline" onclick="closeModal('workingBuilderModal')">Cancel</button>
                <button class="btn btn-gold working-save-btn" id="workingSaveBtn" onclick="saveWorking()">
                    <span class="save-icon"><i data-lucide="sparkles"></i></span>
                    Begin Working
                </button>
            </div>
        </div>
    </div>
    </div>

    <!-- Breathing Pattern Manager Modal -->
    <div class="modal" id="breathingPatternModal">
        <div class="modal-overlay" onclick="closeBreathingPatternModal()"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Breathing Patterns</h2>
                <button class="modal-close" onclick="closeBreathingPatternModal()"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom:20px;">
                    <h3 style="margin-bottom:10px;">Create New Pattern</h3>
                    <div class="form-group">
                        <label>Pattern Name</label>
                        <input type="text" id="breathPatternName" placeholder="e.g., Custom Alternate Nostril"
                            class="input">
                    </div>
                    <div class="form-group">
                        <label>Description (optional)</label>
                        <input type="text" id="breathPatternDesc" placeholder="e.g., Advanced 6-phase pattern"
                            class="input">
                    </div>

                    <div style="margin:15px 0;">
                        <label style="display:flex; justify-content:space-between; align-items:center;">
                            <span>Breathing Phases</span>
                            <button class="btn btn-sm btn-outline" onclick="addBreathingPhase()"><i data-lucide="plus"></i> Add Phase</button>
                        </label>
                        <div id="breathingPhasesList" style="margin-top:10px;"></div>
                    </div>

                    <button class="btn btn-gold" onclick="saveBreathingPattern()">Save Pattern</button>
                </div>
                <div style="border-top:1px solid var(--border-color); padding-top:20px;">
                    <h3 style="margin-bottom:15px;">Your Custom Patterns</h3>
                    <div id="customPatternsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <!-- Task Modal - Redesigned -->
    <div class="modal" id="taskModal">
        <div class="modal-overlay" onclick="closeModal('taskModal')"></div>
        <div class="modal-content task-modal-content">
            <div class="modal-header">
                <h2 id="taskModalTitle">
                    <span class="modal-title-icon"><i data-lucide="sparkles"></i></span>
                    New Task
                </h2>
                <button class="modal-close" onclick="closeModal('taskModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <!-- Task Name -->
                <div class="form-group task-name-group">
                    <input type="text" id="taskName" placeholder="What needs to be done?" class="task-name-input" autocomplete="off">
                </div>

                <!-- Quick Options Row -->
                <div class="task-options-row">
                    <!-- Category Selector -->
                    <div class="task-option-group">
                        <label class="option-label">Category</label>
                        <div class="category-chips" id="taskCategoryChips">
                            <button type="button" class="category-chip active" data-value="general">
                                <span class="chip-icon"><i data-lucide="pin"></i></span>
                                <span>General</span>
                            </button>
                            <button type="button" class="category-chip" data-value="work">
                                <span class="chip-icon"><i data-lucide="briefcase"></i></span>
                                <span>Work</span>
                            </button>
                            <button type="button" class="category-chip" data-value="personal">
                                <span class="chip-icon"><i data-lucide="user"></i></span>
                                <span>Personal</span>
                            </button>
                            <button type="button" class="category-chip" data-value="health">
                                <span class="chip-icon"><i data-lucide="heart-pulse"></i></span>
                                <span>Health</span>
                            </button>
                            <button type="button" class="category-chip" data-value="study">
                                <span class="chip-icon"><i data-lucide="book-open"></i></span>
                                <span>Study</span>
                            </button>
                            <button type="button" class="category-chip" data-value="spiritual">
                                <span class="chip-icon"><i data-lucide="sparkles"></i></span>
                                <span>Spiritual</span>
                            </button>
                        </div>
                        <input type="hidden" id="taskCategory" value="general">
                    </div>

                    <!-- Priority Selector -->
                    <div class="task-option-group">
                        <label class="option-label">Priority</label>
                        <div class="priority-selector" id="taskPrioritySelector">
                            <button type="button" class="priority-btn low" data-value="low">
                                <span class="priority-dot"></span>
                                <span>Low</span>
                            </button>
                            <button type="button" class="priority-btn medium active" data-value="medium">
                                <span class="priority-dot"></span>
                                <span>Medium</span>
                            </button>
                            <button type="button" class="priority-btn high" data-value="high">
                                <span class="priority-dot"></span>
                                <span>High</span>
                            </button>
                        </div>
                        <input type="hidden" id="taskPriority" value="medium">
                    </div>
                </div>

                <!-- Due Date & Description Row -->
                <div class="task-details-row">
                    <div class="task-option-group">
                        <label class="option-label">Due Date</label>
                        <div class="date-input-wrapper">
                            <span class="date-icon"><i data-lucide="calendar"></i></span>
                            <input type="date" id="taskDueDate" class="date-input">
                            <button type="button" class="date-clear-btn" onclick="clearTaskDueDate()" title="Clear date"><i data-lucide="x"></i></button>
                        </div>
                    </div>
                    <div class="task-option-group task-desc-group">
                        <label class="option-label">Notes <span class="optional-tag">(optional)</span></label>
                        <textarea id="taskDescription" placeholder="Add any details..." class="task-description-input" rows="2"></textarea>
                    </div>
                </div>

                <!-- Subtasks (Optional) -->
                <div class="task-subtasks-section">
                    <div class="subtasks-header" onclick="toggleSubtasksPanel()">
                        <span class="subtasks-icon"><i data-lucide="list-checks"></i></span>
                        <span>Subtasks</span>
                        <span class="subtasks-count" id="subtasksCount">(0)</span>
                        <span class="subtasks-toggle"><i data-lucide="chevron-down"></i></span>
                    </div>
                    <div class="subtasks-panel" id="subtasksPanel" style="display:none;">
                        <div class="subtasks-list" id="subtasksList"></div>
                        <div class="add-subtask-row">
                            <input type="text" id="newSubtaskInput" placeholder="Add a subtask..." class="subtask-input" onkeypress="handleSubtaskKeypress(event)">
                            <button type="button" class="add-subtask-btn" onclick="addSubtask()"><i data-lucide="plus"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer task-modal-footer">
                <button class="btn btn-outline" onclick="closeModal('taskModal')">Cancel</button>
                <button class="btn btn-gold task-save-btn" onclick="saveTask()">
                    <span class="save-icon"><i data-lucide="check"></i></span>
                    Save Task
                </button>
            </div>
        </div>
    </div>

    <!-- Mastery Modal - Redesigned -->
    <div class="modal" id="masteryModal">
        <div class="modal-overlay" onclick="closeModal('masteryModal')"></div>
        <div class="modal-content mastery-modal-content">
            <div class="modal-header">
                <h2 id="masteryModalTitle">Create Mastery Goal</h2>
                <button class="modal-close" onclick="closeModal('masteryModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <!-- Step Indicator -->
                <div class="mastery-wizard-steps">
                    <div class="wizard-step active" data-step="1">
                        <span class="step-num">1</span>
                        <span class="step-label">Goal</span>
                    </div>
                    <div class="wizard-connector"></div>
                    <div class="wizard-step" data-step="2">
                        <span class="step-num">2</span>
                        <span class="step-label">Target</span>
                    </div>
                    <div class="wizard-connector"></div>
                    <div class="wizard-step" data-step="3">
                        <span class="step-num">3</span>
                        <span class="step-label">Style</span>
                    </div>
                </div>

                <!-- Step 1: Goal Info -->
                <div class="wizard-panel active" data-panel="1">
                    <div class="form-group">
                        <label>What are you mastering?</label>
                        <input type="text" id="masteryName" placeholder="e.g., Piano, Coding, Meditation, Drawing..." class="input mastery-input-large">
                    </div>

                    <div class="form-group">
                        <label>Choose an icon</label>
                        <div class="mastery-icon-selector" id="masteryIconGrid">
                            <div class="icon-category">
                                <span class="icon-cat-label">Mind & Spirit</span>
                                <div class="icon-row">
                                    <div class="mastery-icon-btn active" data-icon="ðŸ§˜">ðŸ§˜</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ“š">ðŸ“š</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ§ ">ðŸ§ </div>
                                    <div class="mastery-icon-btn" data-icon="âœ¨">âœ¨</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ”®">ðŸ”®</div>
                                </div>
                            </div>
                            <div class="icon-category">
                                <span class="icon-cat-label">Creative</span>
                                <div class="icon-row">
                                    <div class="mastery-icon-btn" data-icon="ðŸŽ¨">ðŸŽ¨</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸŽµ">ðŸŽµ</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸŽ¹">ðŸŽ¹</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸŽ¸">ðŸŽ¸</div>
                                    <div class="mastery-icon-btn" data-icon="âœï¸">âœï¸</div>
                                </div>
                            </div>
                            <div class="icon-category">
                                <span class="icon-cat-label">Physical</span>
                                <div class="icon-row">
                                    <div class="mastery-icon-btn" data-icon="ðŸ‹ï¸">ðŸ‹ï¸</div>
                                    <div class="mastery-icon-btn" data-icon="âš”ï¸">âš”ï¸</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ¥‹">ðŸ¥‹</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸƒ">ðŸƒ</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ§—">ðŸ§—</div>
                                </div>
                            </div>
                            <div class="icon-category">
                                <span class="icon-cat-label">Tech & Work</span>
                                <div class="icon-row">
                                    <div class="mastery-icon-btn" data-icon="ðŸ’»">ðŸ’»</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ§ª">ðŸ§ª</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ“Š">ðŸ“Š</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸ› ï¸">ðŸ› ï¸</div>
                                    <div class="mastery-icon-btn" data-icon="ðŸŽ®">ðŸŽ®</div>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="masteryIcon" value="ðŸ§˜">
                    </div>
                </div>

                <!-- Step 2: Target Setting -->
                <div class="wizard-panel" data-panel="2">
                    <div class="form-group">
                        <label>How do you measure progress?</label>
                        <div class="mastery-type-selector">
                            <label class="type-card active" data-type="hours">
                                <input type="radio" name="masteryType" value="hours" checked style="display:none;">
                                <div class="type-icon"><i data-lucide="clock"></i></div>
                                <div class="type-info">
                                    <span class="type-title">Time-Based</span>
                                    <span class="type-desc">Track hours practiced</span>
                                </div>
                            </label>
                            <label class="type-card" data-type="reps">
                                <input type="radio" name="masteryType" value="reps" style="display:none;">
                                <div class="type-icon"><i data-lucide="hash"></i></div>
                                <div class="type-info">
                                    <span class="type-title">Count-Based</span>
                                    <span class="type-desc">Track repetitions</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label id="masteryGoalLabel">Set your target</label>
                        <div class="mastery-goal-presets">
                            <button type="button" class="goal-preset" data-value="10" onclick="selectGoalPreset(10)">
                                <span class="preset-value">10</span>
                                <span class="preset-label">Beginner</span>
                            </button>
                            <button type="button" class="goal-preset" data-value="100" onclick="selectGoalPreset(100)">
                                <span class="preset-value">100</span>
                                <span class="preset-label">Novice</span>
                            </button>
                            <button type="button" class="goal-preset" data-value="1000" onclick="selectGoalPreset(1000)">
                                <span class="preset-value">1K</span>
                                <span class="preset-label">Skilled</span>
                            </button>
                            <button type="button" class="goal-preset active" data-value="10000" onclick="selectGoalPreset(10000)">
                                <span class="preset-value">10K</span>
                                <span class="preset-label">Master</span>
                            </button>
                            <button type="button" class="goal-preset" data-value="custom" onclick="selectGoalPreset('custom')">
                                <span class="preset-value">âˆž</span>
                                <span class="preset-label">Custom</span>
                            </button>
                        </div>
                        <input type="hidden" id="masteryGoal" value="10000">
                        <div class="custom-goal-input" id="customHoursGroup" style="display:none;">
                            <input type="number" id="customHours" min="1" class="input" placeholder="Enter your target number">
                        </div>
                    </div>

                    <div class="mastery-milestone-preview">
                        <span class="preview-label">Your Milestones</span>
                        <div class="milestones-mini" id="milestonesPreview">
                            <div class="milestone-dot" data-pct="25"><span>25%</span></div>
                            <div class="milestone-dot" data-pct="50"><span>50%</span></div>
                            <div class="milestone-dot" data-pct="75"><span>75%</span></div>
                            <div class="milestone-dot" data-pct="100"><span>100%</span></div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Styling -->
                <div class="wizard-panel" data-panel="3">
                    <div class="form-group">
                        <label>Choose your theme color</label>
                        <div class="mastery-color-picker">
                            <label class="color-btn active" data-color="#d4af37">
                                <input type="radio" name="masteryColor" value="#d4af37" checked style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #d4af37, #f0d060);"></span>
                                <span class="color-name">Gold</span>
                            </label>
                            <label class="color-btn" data-color="#9b59b6">
                                <input type="radio" name="masteryColor" value="#9b59b6" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #9b59b6, #d4a5ff);"></span>
                                <span class="color-name">Mystic</span>
                            </label>
                            <label class="color-btn" data-color="#3498db">
                                <input type="radio" name="masteryColor" value="#3498db" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #3498db, #85c1e9);"></span>
                                <span class="color-name">Ocean</span>
                            </label>
                            <label class="color-btn" data-color="#2ecc71">
                                <input type="radio" name="masteryColor" value="#2ecc71" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #2ecc71, #82e0aa);"></span>
                                <span class="color-name">Forest</span>
                            </label>
                            <label class="color-btn" data-color="#e74c3c">
                                <input type="radio" name="masteryColor" value="#e74c3c" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #e74c3c, #f1948a);"></span>
                                <span class="color-name">Fire</span>
                            </label>
                            <label class="color-btn" data-color="#1abc9c">
                                <input type="radio" name="masteryColor" value="#1abc9c" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #1abc9c, #76d7c4);"></span>
                                <span class="color-name">Teal</span>
                            </label>
                            <label class="color-btn" data-color="#f39c12">
                                <input type="radio" name="masteryColor" value="#f39c12" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #f39c12, #f8c471);"></span>
                                <span class="color-name">Amber</span>
                            </label>
                            <label class="color-btn" data-color="#e91e63">
                                <input type="radio" name="masteryColor" value="#e91e63" style="display:none;">
                                <span class="color-swatch" style="background: linear-gradient(135deg, #e91e63, #f48fb1);"></span>
                                <span class="color-name">Rose</span>
                            </label>
                        </div>
                    </div>

                    <!-- Goal Preview Card -->
                    <div class="mastery-preview-card" id="masteryPreviewCard">
                        <div class="preview-card-header">
                            <span class="preview-icon" id="previewIcon">ðŸ§˜</span>
                            <span class="preview-name" id="previewName">Your Goal</span>
                        </div>
                        <div class="preview-progress">
                            <div class="preview-bar">
                                <div class="preview-fill" id="previewFill"></div>
                            </div>
                            <span class="preview-target" id="previewTarget">0 / 10,000 hours</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer mastery-modal-footer">
                <button class="btn btn-outline" id="masteryPrevBtn" onclick="masteryWizardPrev()" style="display:none;"><i data-lucide="arrow-left"></i> Back</button>
                <div class="footer-spacer"></div>
                <button class="btn btn-outline" onclick="closeModal('masteryModal')">Cancel</button>
                <button class="btn btn-gold" id="masteryNextBtn" onclick="masteryWizardNext()">Next <i data-lucide="arrow-right"></i></button>
                <button class="btn btn-gold" id="masterySaveBtn" onclick="saveMastery()" style="display:none;">Create Goal</button>
            </div>
        </div>
    </div>

    <!-- Journal Entry Modal -->
    <div class="modal" id="journalModal">
        <div class="modal-overlay" onclick="closeModal('journalModal')"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="journalModalTitle">New Journal Entry</h2>
                <button class="modal-close" onclick="closeModal('journalModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="journalEditId" value="">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="journalTitle" placeholder="Entry title..." class="input">
                </div>
                <div class="form-group">
                    <label>Related To</label>
                    <select id="journalRelated" class="input">
                        <option value="">General Entry</option>
                        <optgroup label="Flows" id="journalFlowOptions"></optgroup>
                        <optgroup label="Workings" id="journalWorkingOptions"></optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mood</label>
                    <div class="mood-selector">
                        <label class="mood-option"><input type="radio" name="journalMood"
                                value="great"><span>ðŸ˜Š</span></label>
                        <label class="mood-option"><input type="radio" name="journalMood"
                                value="good"><span>ðŸ™‚</span></label>
                        <label class="mood-option"><input type="radio" name="journalMood" value="neutral"
                                checked><span>ðŸ˜</span></label>
                        <label class="mood-option"><input type="radio" name="journalMood"
                                value="low"><span>ðŸ˜”</span></label>
                        <label class="mood-option"><input type="radio" name="journalMood"
                                value="bad"><span>ðŸ˜¢</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Entry</label>
                    <textarea id="journalContent" placeholder="Write your thoughts..."
                        class="input journal-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label>Tags (comma separated)</label>
                    <input type="text" id="journalTags" placeholder="insight, breakthrough, gratitude" class="input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('journalModal')">Cancel</button>
                <button class="btn btn-gold" id="journalSaveBtn" onclick="saveJournalEntry()">Save Entry</button>
            </div>
        </div>
    </div>

    <!-- Quick Timer Modal -->
    <div class="modal" id="quickTimerModal">
        <div class="modal-overlay" onclick="closeModal('quickTimerModal')"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Quick Timer</h2>
                <button class="modal-close" onclick="closeModal('quickTimerModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Minutes</label>
                        <input type="number" id="quickTimerMinutes" value="5" min="0" max="999" class="input">
                    </div>
                    <div class="form-group">
                        <label>Seconds</label>
                        <input type="number" id="quickTimerSeconds" value="0" min="0" max="59" class="input">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('quickTimerModal')">Cancel</button>
                <button class="btn btn-gold" onclick="launchQuickTimer()">Start</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-overlay" onclick="closeModal('confirmModal')"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2 id="confirmTitle">Confirm</h2>
                <button class="modal-close" onclick="closeModal('confirmModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('confirmModal')">Cancel</button>
                <button class="btn btn-danger" id="confirmAction">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Flow Runner (Fullscreen) -->
    <div class="flow-runner" id="flowRunner">
        <div class="runner-background"></div>
        <button class="runner-exit" onclick="exitFlowRunner()"><i data-lucide="x"></i></button>

        <div class="runner-progress">
            <div class="runner-progress-bar" id="runnerProgressBar"></div>
            <span class="runner-progress-text" id="runnerProgressText">1 / 3</span>
        </div>

        <div class="runner-content" id="runnerContent">
            <!-- Dynamic content based on component type -->
        </div>

        <div class="runner-controls" id="runnerControls">
            <!-- Dynamic controls -->
        </div>
    </div>

    <!-- Flow Preview Modal -->
    <div class="modal" id="flowPreviewModal">
        <div class="modal-overlay" onclick="closeModal('flowPreviewModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="previewFlowTitle">Flow Title</h2>
                <button class="modal-close" onclick="closeModal('flowPreviewModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <p id="previewFlowDesc" style="color:var(--text-muted); margin-bottom:20px;"></p>

                <h4 style="margin-bottom:10px; color:var(--gold-primary);">Steps</h4>
                <div id="previewFlowSteps" style="max-height:300px; overflow-y:auto; margin-bottom:20px;">
                    <!-- Steps list -->
                </div>

                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('flowPreviewModal')">Cancel</button>
                    <button class="btn btn-gold" id="startFlowBtn">Start Flow</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Breathing Visualizer Overlay -->
    <div class="breathing-overlay" id="breathingOverlay">
        <div class="breath-cosmos" id="breathCosmos"></div>
        <div class="breath-orbs">
            <div class="breath-orb breath-orb-1"></div>
            <div class="breath-orb breath-orb-2"></div>
            <div class="breath-orb breath-orb-3"></div>
        </div>
        
        <button class="breath-close" onclick="closeBreathingExercise()">
            <i data-lucide="x"></i>
        </button>
        
        <div class="breath-content">
            <!-- Top Controls -->
            <div class="breath-top-bar">
                <div class="breath-pattern-select">
                    <i data-lucide="wind"></i>
                    <select id="breathingPattern" class="breath-select">
                        <!-- Options populated dynamically from config.js -->
                    </select>
                </div>
                <button class="breath-customize-btn" onclick="openBreathingPatternManager()">
                    <i data-lucide="settings-2"></i>
                    <span>Customize</span>
                </button>
            </div>
            
            <!-- Main Visualization -->
            <div class="breath-main">
                <div class="breath-ring-container">
                    <!-- Outer decorative rings -->
                    <svg class="breath-rings-svg" viewBox="0 0 400 400">
                        <circle class="breath-ring-outer" cx="200" cy="200" r="190" />
                        <circle class="breath-ring-middle" cx="200" cy="200" r="170" />
                        <circle class="breath-ring-progress" id="breathProgressRing" cx="200" cy="200" r="150" />
                    </svg>
                    
                    <!-- Central orb -->
                    <div class="breath-central-orb" id="breathingCircle">
                        <div class="breath-orb-glow"></div>
                        <div class="breath-orb-core">
                            <span class="breath-timer" id="breathingTimer"></span>
                            <span class="breath-phase" id="breathingText">Ready</span>
                        </div>
                    </div>
                </div>
                
                <!-- Instruction Card -->
                <div class="breath-instruction-card" id="breathingInstruction">
                    <i data-lucide="sparkles"></i>
                    <span>Select a pattern and press Start</span>
                </div>
            </div>
            
            <!-- Bottom Controls -->
            <div class="breath-controls">
                <div class="breath-stats">
                    <div class="breath-stat">
                        <span class="breath-stat-value" id="breathCycleCount">0</span>
                        <span class="breath-stat-label">Cycles</span>
                    </div>
                    <div class="breath-stat">
                        <span class="breath-stat-value" id="breathSessionTime">0:00</span>
                        <span class="breath-stat-label">Session</span>
                    </div>
                </div>
                
                <button class="btn-breath-start" id="breathingStartBtn" onclick="startBreathingLoop()">
                    <i data-lucide="play"></i>
                    <span>Begin Session</span>
                </button>
                <button class="btn-breath-stop" id="breathingStopBtn" onclick="stopBreathingLoop()" style="display:none;">
                    <i data-lucide="pause"></i>
                    <span>Pause</span>
                </button>
            </div>
        </div>
        
        <!-- Hidden particle container for compatibility -->
        <div class="breathing-particles" id="breathingParticles" style="display:none;"></div>
    </div>

    <!-- Working Detail Modal -->
    <div class="modal" id="workingDetailModal">
        <div class="modal-overlay" onclick="closeModal('workingDetailModal')"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="workingDetailTitle">Working Details</h2>
                <button class="modal-close" onclick="closeModal('workingDetailModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body" id="workingDetailBody">
                <!-- Populated dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('workingDetailModal')">Close</button>
                <button class="btn btn-gold" id="workingDetailAction">Practice Today</button>
            </div>
        </div>
    </div>

    <!-- Weekly Schedule Item Modal -->
    <div class="modal" id="routineModal">
        <div class="modal-overlay" onclick="closeModal('routineModal')"></div>
        <div class="modal-content routine-modal-content">
            <div class="routine-modal-header">
                <div class="routine-modal-icon">
                    <i data-lucide="calendar-plus"></i>
                </div>
                <h2 id="routineModalTitle">Create New Routine</h2>
                <p class="routine-modal-subtitle">Schedule your weekly activities</p>
                <button class="modal-close" onclick="closeModal('routineModal')"><i data-lucide="x"></i></button>
            </div>

            <div class="modal-body routine-modal-body">
                <input type="hidden" id="routineItemId">
                
                <!-- Routine Name -->
                <div class="routine-form-section">
                    <label class="routine-label">
                        <i data-lucide="type"></i>
                        Routine Name
                    </label>
                    <input type="text" id="routineItemName" class="routine-input" placeholder="e.g., Morning workout, Team meeting, Study session...">
                </div>

                <!-- Days Selection - Visual Pills -->
                <div class="routine-form-section">
                    <label class="routine-label">
                        <i data-lucide="calendar-days"></i>
                        Active Days
                    </label>
                    <div class="routine-days-grid">
                        <label class="routine-day-pill" data-day="monday">
                            <input type="checkbox" name="routineDays" value="monday">
                            <span class="pill-content">
                                <span class="pill-short">M</span>
                                <span class="pill-full">Monday</span>
                            </span>
                        </label>
                        <label class="routine-day-pill" data-day="tuesday">
                            <input type="checkbox" name="routineDays" value="tuesday">
                            <span class="pill-content">
                                <span class="pill-short">T</span>
                                <span class="pill-full">Tuesday</span>
                            </span>
                        </label>
                        <label class="routine-day-pill" data-day="wednesday">
                            <input type="checkbox" name="routineDays" value="wednesday">
                            <span class="pill-content">
                                <span class="pill-short">W</span>
                                <span class="pill-full">Wednesday</span>
                            </span>
                        </label>
                        <label class="routine-day-pill" data-day="thursday">
                            <input type="checkbox" name="routineDays" value="thursday">
                            <span class="pill-content">
                                <span class="pill-short">T</span>
                                <span class="pill-full">Thursday</span>
                            </span>
                        </label>
                        <label class="routine-day-pill" data-day="friday">
                            <input type="checkbox" name="routineDays" value="friday">
                            <span class="pill-content">
                                <span class="pill-short">F</span>
                                <span class="pill-full">Friday</span>
                            </span>
                        </label>
                        <label class="routine-day-pill weekend" data-day="saturday">
                            <input type="checkbox" name="routineDays" value="saturday">
                            <span class="pill-content">
                                <span class="pill-short">S</span>
                                <span class="pill-full">Saturday</span>
                            </span>
                        </label>
                        <label class="routine-day-pill weekend" data-day="sunday">
                            <input type="checkbox" name="routineDays" value="sunday">
                            <span class="pill-content">
                                <span class="pill-short">S</span>
                                <span class="pill-full">Sunday</span>
                            </span>
                        </label>
                    </div>
                    <div class="quick-day-actions">
                        <button type="button" class="quick-day-btn" onclick="selectAllDays()">Every Day</button>
                        <button type="button" class="quick-day-btn" onclick="selectWeekdays()">Weekdays</button>
                        <button type="button" class="quick-day-btn" onclick="selectWeekends()">Weekends</button>
                    </div>
                </div>

                <!-- Category Selection - Visual Cards -->
                <div class="routine-form-section">
                    <label class="routine-label">
                        <i data-lucide="shapes"></i>
                        Category
                    </label>
                    <div class="routine-category-grid">
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="meditation">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸ§˜</span>
                                <span class="category-name">Meditation</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="chakra">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸŒˆ</span>
                                <span class="category-name">Chakra Work</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="magick">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸ”®</span>
                                <span class="category-name">Magick</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="health">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸ’ª</span>
                                <span class="category-name">Health</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="personal" checked>
                            <span class="category-card-content">
                                <span class="category-icon">âœ¨</span>
                                <span class="category-name">Personal</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="learning">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸ“š</span>
                                <span class="category-name">Learning</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="creative">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸŽ¨</span>
                                <span class="category-name">Creative</span>
                            </span>
                        </label>
                        <label class="routine-category-card">
                            <input type="radio" name="routineCategory" value="work">
                            <span class="category-card-content">
                                <span class="category-icon">ðŸ’¼</span>
                                <span class="category-name">Work</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Color Selection -->
                <div class="routine-form-section">
                    <label class="routine-label">
                        <i data-lucide="palette"></i>
                        Color Tag
                    </label>
                    <div class="routine-color-swatches">
                        <label class="routine-color-swatch" title="Gold">
                            <input type="radio" name="routineColor" value="#d4af37" checked>
                            <span style="--swatch-color: #d4af37"></span>
                        </label>
                        <label class="routine-color-swatch" title="Purple">
                            <input type="radio" name="routineColor" value="#9370db">
                            <span style="--swatch-color: #9370db"></span>
                        </label>
                        <label class="routine-color-swatch" title="Teal">
                            <input type="radio" name="routineColor" value="#4ecdc4">
                            <span style="--swatch-color: #4ecdc4"></span>
                        </label>
                        <label class="routine-color-swatch" title="Red">
                            <input type="radio" name="routineColor" value="#ff6b6b">
                            <span style="--swatch-color: #ff6b6b"></span>
                        </label>
                        <label class="routine-color-swatch" title="Mint - Growth">
                            <input type="radio" name="routineColor" value="#95e1d3">
                            <span style="--swatch-color: #95e1d3"></span>
                        </label>
                        <label class="routine-color-swatch" title="Coral - Passion">
                            <input type="radio" name="routineColor" value="#f38181">
                            <span style="--swatch-color: #f38181"></span>
                        </label>
                        <label class="routine-color-swatch" title="Lavender - Peace">
                            <input type="radio" name="routineColor" value="#aa96da">
                            <span style="--swatch-color: #aa96da"></span>
                        </label>
                        <label class="routine-color-swatch" title="Blue - Wisdom">
                            <input type="radio" name="routineColor" value="#74b9ff">
                            <span style="--swatch-color: #74b9ff"></span>
                        </label>
                    </div>
                </div>

                <!-- Notes - Optional -->
                <div class="routine-form-section">
                    <label class="routine-label">
                        <i data-lucide="scroll-text"></i>
                        Notes <span class="optional-tag">(optional)</span>
                    </label>
                    <textarea id="routineItemNotes" class="routine-textarea" rows="3" placeholder="Add any instructions or reminders for this routine..."></textarea>
                </div>
            </div>

            <div class="modal-footer routine-modal-footer">
                <button class="btn btn-danger" id="deleteRoutineBtn" onclick="deleteRoutine()" style="display:none;">
                    <i data-lucide="trash-2"></i>
                </button>
                <div style="flex:1"></div>
                <button class="btn btn-outline" onclick="closeModal('routineModal')">Cancel</button>
                <button class="btn btn-gold btn-glow" onclick="saveRoutine()">
                    <i data-lucide="check"></i>
                    <span id="saveRoutineBtnText">Create Routine</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
    <!-- Import Preview Modal -->
    <div class="modal" id="importPreviewModal">
        <div class="modal-overlay" onclick="closeModal('importPreviewModal')"></div>
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Backup Preview</h2>
                <button class="modal-close" onclick="closeModal('importPreviewModal')"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:20px; color:var(--text-muted);">Review the contents of this backup before
                    merging it with your local data.</p>
                <div id="importPreviewSummary" class="import-summary-grid">
                    <!-- Summary items will be injected here -->
                </div>
                <div
                    style="margin-top:20px; padding:15px; background:rgba(212, 175, 55, 0.05); border:1px solid var(--border-gold); border-radius:12px;">
                    <p style="font-size:0.85rem; color:var(--gold-primary);"><span style="margin-right:8px;"><i data-lucide="info"></i></span>
                        This will merge existing data. Duplicate flows will be skipped.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('importPreviewModal')">Cancel</button>
                <button class="btn btn-gold" id="confirmImportBtn">Confirm & Merge</button>
            </div>
        </div>
    </div>
</body>

</html>
